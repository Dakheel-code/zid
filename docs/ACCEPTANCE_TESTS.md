# Phase 6 โ ุงุฎุชุจุงุฑุงุช ุงููุจูู (Acceptance Criteria)

## ูุธุฑุฉ ุนุงูุฉ

ูุฐุง ุงูููู ูุญุชูู ุนูู ุงุฎุชุจุงุฑุงุช ุงููุจูู ุงููุฏููุฉ ููุชุญูู ูู ุตุญุฉ ุนูู ุงููุธุงู.

---

## ๐งช AC-1: ุฅูุดุงุก ูุชุฌุฑ ุฌุฏูุฏ (Admin)

### ุงูุณููุงุฑูู
Admin ููุดุฆ ูุชุฌุฑ ุจุงูุฑุงุจุท ููุท

### ุงูุฎุทูุงุช
1. ุชุณุฌูู ุงูุฏุฎูู ูู Admin
2. ุงูุฐูุงุจ ุฅูู `/admin/stores`
3. ุงูููุฑ ุนูู "ุฅุถุงูุฉ ูุชุฌุฑ"
4. ุฅุฏุฎุงู ุฑุงุจุท ุงููุชุฌุฑ ููุท (ูุซุงู: `https://example.zid.store`)
5. ุงูููุฑ ุนูู "ุงูุชุดุงู ุงูุจูุงูุงุช"

### ุงููุชุงุฆุฌ ุงููุชููุนุฉ
- [ ] **AC-1.1**: ูุชู ุงูุชุดุงู ุงุณู ุงููุชุฌุฑ ูู OG tags ุฃู title
- [ ] **AC-1.2**: ูุชู ุงูุชุดุงู ุดุนุงุฑ ุงููุชุฌุฑ ูู OG image
- [ ] **AC-1.3**: ูููู ููู Admin ุชุนุฏูู (override) ุงูุงุณู ูุงูุดุนุงุฑ ูุฏููุงู
- [ ] **AC-1.4**: ูุชู ุงุฎุชูุงุฑ ูุฏูุฑ ุงูุญุณุงุจ ูู ุงููุงุฆูุฉ
- [ ] **AC-1.5**: ุจุนุฏ ุงูุญูุธ:
  - [ ] ุชุธูุฑ ููุงู ุงููุงูุจ ุชููุงุฆูุงู ูููุชุฌุฑ
  - [ ] ููุดุฃ token ููุตูุญุฉ ุงูุนุงูุฉ (store_public_links)
  - [ ] ูุตู ุฅุดุนุงุฑ ูููุฏูุฑ "ูุชุฌุฑ ุฌุฏูุฏ ูุณูุฏ"

### ููุฏ ุงูุงุฎุชุจุงุฑ (Console)
```javascript
// ุงุฎุชุจุงุฑ API ุงูุชุดุงู metadata
fetch('/api/stores/detect', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ url: 'https://example.zid.store' })
}).then(r => r.json()).then(console.log)
```

### SQL ููุชุญูู
```sql
-- ุงูุชุญูู ูู ุฅูุดุงุก ุงููุชุฌุฑ
SELECT * FROM stores WHERE store_url = 'https://example.zid.store';

-- ุงูุชุญูู ูู ููุงู ุงููุงูุจ
SELECT * FROM store_tasks WHERE store_id = '<store_id>';

-- ุงูุชุญูู ูู token ุงูุตูุญุฉ ุงูุนุงูุฉ
SELECT * FROM store_public_links WHERE store_id = '<store_id>';

-- ุงูุชุญูู ูู ุงูุฅุดุนุงุฑ
SELECT * FROM notifications_v2 
WHERE recipient_user_id = '<manager_id>' 
AND event_key = 'store.assigned';
```

---

## ๐งช AC-2: ุชุบููุฑ ุญุงูุฉ ุงููุชุฌุฑ ุฅูู ููุชูู (Manager)

### ุงูุณููุงุฑูู
Manager ูุบููุฑ ุญุงูุฉ ุงููุชุฌุฑ ุฅูู `ended`

### ุงูุฎุทูุงุช
1. ุชุณุฌูู ุงูุฏุฎูู ูู Manager
2. ุงูุฐูุงุจ ุฅูู `/manager/stores`
3. ุงุฎุชูุงุฑ ูุชุฌุฑ ูุดุท
4. ุชุบููุฑ ุงูุญุงูุฉ ุฅูู "ููุชูู"

### ุงููุชุงุฆุฌ ุงููุชููุนุฉ
- [ ] **AC-2.1**: ููุณุฌู `ended_at` ุจุงูุชุงุฑูุฎ ุงูุญุงูู
- [ ] **AC-2.2**: `public_access_expires_at` = `ended_at` + 30 ููู
- [ ] **AC-2.3**: ุงูุตูุญุฉ ุงูุนุงูุฉ ุชุนูู ุฎูุงู 30 ููู
- [ ] **AC-2.4**: ุจุนุฏ 30 ูููุ ุงูุตูุญุฉ ุชุนุฑุถ ุฑุณุงูุฉ "ุงูุชูุช ุตูุงุญูุฉ ุงููุตูู"

### SQL ููุชุญูู
```sql
-- ุงูุชุญูู ูู ุชุญุฏูุซ ุงูุชูุงุฑูุฎ
SELECT 
  id,
  status,
  ended_at,
  public_access_expires_at,
  (public_access_expires_at - ended_at) as days_diff
FROM stores 
WHERE id = '<store_id>';

-- ูุฌุจ ุฃู ูููู days_diff = 30 days
```

### ููุฏ ุงูุงุฎุชุจุงุฑ (Trigger)
```sql
-- ุงุฎุชุจุงุฑ trigger ุชุบููุฑ ุงูุญุงูุฉ
UPDATE stores SET status = 'ended' WHERE id = '<store_id>';

-- ุงูุชุญูู
SELECT ended_at, public_access_expires_at FROM stores WHERE id = '<store_id>';
```

---

## ๐งช AC-3: ุงูุตูุญุฉ ุงูุนุงูุฉ ููุชุงุฌุฑ

### ุงูุณููุงุฑูู
ุงูุชุงุฌุฑ ููุชุญ ุงูุตูุญุฉ ุงูุนุงูุฉ ุนุจุฑ ุงูู token

### ุงูุฎุทูุงุช
1. ุงูุญุตูู ุนูู ุฑุงุจุท ุงูุตูุญุฉ ุงูุนุงูุฉ `/public/store/<token>`
2. ูุชุญ ุงูุฑุงุจุท ูู ูุชุตูุญ (ุจุฏูู ุชุณุฌูู ุฏุฎูู)

### ุงููุชุงุฆุฌ ุงููุชููุนุฉ
- [ ] **AC-3.1**: ูุฑู ููุงู ุงููุงูุจ ููุท (visible_to_merchant = true)
- [ ] **AC-3.2**: ุงูููุงู ุชุธูุฑ ุจุญุงูุชูู ููุท:
  - "ููุฏ ุงููุชุงุจุนุฉ" (new, in_progress)
  - "ููุฌุฒ" (done)
- [ ] **AC-3.3**: ูุฑู ุจูุงูุงุช ูุฏูุฑ ุงูุนูุงูุฉ (ุงูุงุณูุ ุงูุตูุฑุฉ)
- [ ] **AC-3.4**: ูุฑู ุฒุฑ ูุงุชุณุงุจ ููุชูุงุตู ูุน ุงููุฏูุฑ
- [ ] **AC-3.5**: ููููู ุฅูุดุงุก ูููุฉ ุฌุฏูุฏุฉ (ุทูุจ)
- [ ] **AC-3.6**: ุนูุฏ ุฅูุดุงุก ูููุฉ:
  - ุชุธูุฑ ูููุฏูุฑ ูู ูุงุฆูุฉ ุงูููุงู
  - ูุตู ุฅุดุนุงุฑ ูููุฏูุฑ "ูููุฉ ุฌุฏูุฏุฉ ูู ุงูุชุงุฌุฑ"

### SQL ููุชุญูู
```sql
-- ุงูุชุญูู ูู ุงูููุงู ุงููุฑุฆูุฉ ููุชุงุฌุฑ
SELECT id, title, status, visible_to_merchant
FROM store_tasks 
WHERE store_id = '<store_id>' 
AND visible_to_merchant = true;

-- ุงูุชุญูู ูู ูููุฉ ุงูุชุงุฌุฑ ุงูุฌุฏูุฏุฉ
SELECT * FROM store_tasks 
WHERE store_id = '<store_id>' 
AND created_by_role = 'merchant';

-- ุงูุชุญูู ูู ุงูุฅุดุนุงุฑ
SELECT * FROM notifications_v2 
WHERE event_key = 'task.merchant_created';
```

---

## ๐งช AC-4: ุงูุชุนุงููู ุงูุนุงุฌูุฉ

### ุงูุณููุงุฑูู
Admin ูุฑุณู ุชุนููู ุนุงุฌู (urgent_popup)

### ุงูุฎุทูุงุช
1. ุชุณุฌูู ุงูุฏุฎูู ูู Admin
2. ุงูุฐูุงุจ ุฅูู `/admin/announcements`
3. ุฅูุดุงุก ุชุนููู ุฌุฏูุฏ
4. ุงุฎุชูุงุฑ ุงูููุน "ุนุงุฌู (popup)"
5. ุฅุฑุณุงู ุงูุชุนููู

### ุงููุชุงุฆุฌ ุงููุชููุนุฉ
- [ ] **AC-4.1**: ูุธูุฑ popup ูููุฏูุฑ ุนูุฏ ูุชุญ ุฃู ุตูุญุฉ
- [ ] **AC-4.2**: ุงูู popup ูุธูุฑ ูุฑุฉ ูุงุญุฏุฉ ููุท (ููุณุฌู ูู announcement_reads)
- [ ] **AC-4.3**: ูุธูุฑ ุฅุดุนุงุฑ ูู ุงูุฌุฑุณ
- [ ] **AC-4.4**: ุงูุชุนููู ูุธูุฑ ูู ุตูุญุฉ ุงูุชุนุงููู `/manager/announcements`

### SQL ููุชุญูู
```sql
-- ุงูุชุญูู ูู ุงูุชุนููู
SELECT * FROM announcements_v2 
WHERE type = 'urgent_popup' 
ORDER BY created_at DESC LIMIT 1;

-- ุงูุชุญูู ูู ุงูุฃูุฏุงู
SELECT * FROM announcement_targets 
WHERE announcement_id = '<announcement_id>';

-- ุงูุชุญูู ูู ุงููุฑุงุกุฉ (ุจุนุฏ ุนุฑุถ popup)
SELECT * FROM announcement_reads 
WHERE announcement_id = '<announcement_id>';

-- ุงูุชุญูู ูู ุงูุฅุดุนุงุฑ
SELECT * FROM notifications_v2 
WHERE event_key = 'announcement.urgent';
```

---

## ๐งช AC-5: ุฅุนุฏุงุฏุงุช ุงูุงุฌุชูุงุนุงุช

### ุงูุณููุงุฑูู
Manager ูุถุจุท ุณุงุนุงุช ุงูุนูู ูุฃููุงุช ุงูุฑุงุญุฉ

### ุงูุฎุทูุงุช
1. ุชุณุฌูู ุงูุฏุฎูู ูู Manager
2. ุงูุฐูุงุจ ุฅูู `/manager/meetings`
3. ุชุจููุจ "ุณุงุนุงุช ุงูุนูู"
4. ุชุญุฏูุฏ ุงูุฃูุงู ูุงูุฃููุงุช ุงููุชุงุญุฉ
5. ุชุจููุจ "ุฃููุงุช ุงูุฑุงุญุฉ"
6. ุฅุถุงูุฉ ูุชุฑุฉ ุฑุงุญุฉ/ุฅุฌุงุฒุฉ

### ุงููุชุงุฆุฌ ุงููุชููุนุฉ
- [ ] **AC-5.1**: ุตูุญุฉ ุงูุญุฌุฒ `/book/<slug>` ุชุนุฑุถ ููุท ุงูุฃููุงุช ุงููุชุงุญุฉ
- [ ] **AC-5.2**: ุงูุฃููุงุช ุฎุงุฑุฌ ุณุงุนุงุช ุงูุนูู ูุง ุชุธูุฑ
- [ ] **AC-5.3**: ุฃููุงุช ุงูุฑุงุญุฉ/ุงูุฅุฌุงุฒุงุช ูุง ุชุธูุฑ
- [ ] **AC-5.4**: ุงูุฃููุงุช ุงููุญุฌูุฒุฉ ูุณุจูุงู ูุง ุชุธูุฑ

### SQL ููุชุญูู
```sql
-- ุงูุชุญูู ูู ุณุงุนุงุช ุงูุนูู
SELECT * FROM availability_rules 
WHERE manager_id = '<manager_id>';

-- ุงูุชุญูู ูู ุฃููุงุช ุงูุฑุงุญุฉ
SELECT * FROM time_off 
WHERE manager_id = '<manager_id>';

-- ุงูุชุญูู ูู ุงูุงุฌุชูุงุนุงุช ุงููุญุฌูุฒุฉ
SELECT * FROM meetings_v2 
WHERE manager_id = '<manager_id>' 
AND status = 'booked';
```

---

## ๐งช AC-6: ุญุฌุฒ ุงุฌุชูุงุน

### ุงูุณููุงุฑูู
ุนููู ูุญุฌุฒ ููุนุฏ ูุน ุงููุฏูุฑ

### ุงูุฎุทูุงุช
1. ูุชุญ ุตูุญุฉ ุงูุญุฌุฒ `/book/<slug>`
2. ุงุฎุชูุงุฑ ุชุงุฑูุฎ ูููุช ูุชุงุญ
3. ุฅุฏุฎุงู ุงูุจูุงูุงุช (ุงูุงุณูุ ุงูุจุฑูุฏุ ุงููุงุชู)
4. ุชุฃููุฏ ุงูุญุฌุฒ

### ุงููุชุงุฆุฌ ุงููุชููุนุฉ
- [ ] **AC-6.1**: ูุตู ุชุฃููุฏ ููุนููู (ุจุฑูุฏ ุฅููุชุฑููู)
- [ ] **AC-6.2**: ูุตู ุฅุดุนุงุฑ ูููุฏูุฑ "ุงุฌุชูุงุน ุฌุฏูุฏ ูุญุฌูุฒ"
- [ ] **AC-6.3**: ุงูุงุฌุชูุงุน ูุธูุฑ ูู `/manager/meetings`
- [ ] **AC-6.4**: ุฅุฐุง ูุงู ุญุณุงุจ Google Calendar ูุฑุจูุท:
  - ููุดุฃ ุญุฏุซ ูู Google Calendar
  - ูุญุชูู ุนูู ุฑุงุจุท ุงูุงุฌุชูุงุน ูุงูุชูุงุตูู

### SQL ููุชุญูู
```sql
-- ุงูุชุญูู ูู ุงูุงุฌุชูุงุน
SELECT * FROM meetings_v2 
WHERE manager_id = '<manager_id>' 
ORDER BY created_at DESC LIMIT 1;

-- ุงูุชุญูู ูู ุงูุฅุดุนุงุฑ
SELECT * FROM notifications_v2 
WHERE event_key = 'meeting.booked' 
ORDER BY created_at DESC LIMIT 1;

-- ุงูุชุญูู ูู Google Calendar event
SELECT google_calendar_event_id 
FROM meetings_v2 
WHERE id = '<meeting_id>';
```

---

## ๐ ูุงุฆูุฉ ุงูุชุญูู ุงูููุงุฆูุฉ

### ุงููุชุงุฌุฑ
- [ ] ุฅูุดุงุก ูุชุฌุฑ ุจุงูุฑุงุจุท ููุท
- [ ] ุงูุชุดุงู metadata ุชููุงุฆู
- [ ] Override ูุฏูู ููุจูุงูุงุช
- [ ] ุฅูุดุงุก ููุงู ุงููุงูุจ ุชููุงุฆูุงู
- [ ] ุฅูุดุงุก token ููุตูุญุฉ ุงูุนุงูุฉ
- [ ] ุฅุดุนุงุฑ ุงููุฏูุฑ ุนูุฏ ุงูุฅุณูุงุฏ

### ุญุงูุงุช ุงููุชุฌุฑ
- [ ] ุชุบููุฑ ุงูุญุงูุฉ ูุญุฏุซ ended_at
- [ ] ุญุณุงุจ public_access_expires_at ุตุญูุญ
- [ ] ุงูุตูุญุฉ ุงูุนุงูุฉ ุชุนูู 30 ููู
- [ ] ุฑุณุงูุฉ ุงูุชูุงุก ุงูุตูุงุญูุฉ ุจุนุฏ 30 ููู

### ุงูุตูุญุฉ ุงูุนุงูุฉ
- [ ] ุนุฑุถ ุงูููุงู ุงููุฑุฆูุฉ ููุท
- [ ] ุญุงูุชูู ููุท ููููุงู
- [ ] ุจูุงูุงุช ุงููุฏูุฑ + ูุงุชุณุงุจ
- [ ] ุฅูุดุงุก ูููุฉ ูู ุงูุชุงุฌุฑ
- [ ] ุฅุดุนุงุฑ ุงููุฏูุฑ ุจุงููููุฉ ุงูุฌุฏูุฏุฉ

### ุงูุชุนุงููู
- [ ] ุฅูุดุงุก ุชุนููู ุนุงุฌู
- [ ] Popup ูุธูุฑ ูุฑุฉ ูุงุญุฏุฉ
- [ ] ุฅุดุนุงุฑ ูู ุงูุฌุฑุณ
- [ ] ุชุณุฌูู ุงููุฑุงุกุฉ

### ุงูุงุฌุชูุงุนุงุช
- [ ] ุถุจุท ุณุงุนุงุช ุงูุนูู
- [ ] ุถุจุท ุฃููุงุช ุงูุฑุงุญุฉ
- [ ] ุตูุญุฉ ุงูุญุฌุฒ ุชุนุฑุถ ุงูุฃููุงุช ุงูุตุญูุญุฉ
- [ ] ุชุฃููุฏ ููุทุฑููู
- [ ] ุฅุดุนุงุฑ ูููุฏูุฑ
- [ ] Google Calendar integration

---

## ๐ง ุฃุฏูุงุช ุงูุงุฎุชุจุงุฑ

### Supabase Dashboard
```
https://supabase.com/dashboard/project/<project_id>
```

### API Testing (curl)
```bash
# ุงุฎุชุจุงุฑ ุงูุชุดุงู metadata
curl -X POST http://localhost:3000/api/stores/detect \
  -H "Content-Type: application/json" \
  -d '{"url": "https://example.zid.store"}'
```

### Browser Console
```javascript
// ุงุฎุชุจุงุฑ ุงูุฅุดุนุงุฑุงุช
const { data } = await supabase.rpc('get_notifications', { p_limit: 10 })
console.log(data)

// ุงุฎุชุจุงุฑ ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ
const { data: count } = await supabase.rpc('get_unread_notification_count')
console.log(count)
```

---

## ๐ ููุงุญุธุงุช

1. **ูุจู ุงูุงุฎุชุจุงุฑ**: ุชุฃูุฏ ูู ุชุดุบูู migrations ูู Supabase
2. **ุจูุงูุงุช ุงูุงุฎุชุจุงุฑ**: ุงุณุชุฎุฏู ุจูุงูุงุช ููููุฉ ููุงุฎุชุจุงุฑ
3. **Google Calendar**: ูุชุทูุจ OAuth setup ูุณุจู
4. **ุงูุฅุดุนุงุฑุงุช**: ุชุฃูุฏ ูู ุชูุนูู Realtime ูู Supabase
